import requests
import pandas as pd
import matplotlib.pyplot as plt

# Add countries here
countries = ['Germany','Spain','Italy']

# Confirmed cases with date and more than 50 death
def cases(x):
   confirmed_list = [i['Cases'] for i in requests.get(f'https://api.covid19api.com/total/country/{x}/status/confirmed').json()]
   c_date_list = [i['Date'] for i in requests.get(f'https://api.covid19api.com/total/country/{x}/status/confirmed').json()]    
      
   deaths_list = [i['Cases'] for i in requests.get(f'https://api.covid19api.com/total/country/{x}/status/deaths').json() if i['Cases'] >= 50] 
   d_date_list = [i['Date'] for i in requests.get(f'https://api.covid19api.com/total/country/{x}/status/deaths').json() if i['Cases'] >= 50]    

   confrimed_cases_dates = list(zip(c_date_list, confirmed_list))
   deaths_cases_dates = list(zip(d_date_list, deaths_list))

   df1 = pd.DataFrame(confrimed_cases_dates, columns =['Date', f'Confirmed {x}'])
   df2 = pd.DataFrame(deaths_cases_dates, columns =['Date', f'Deaths {x}'])
   df3 = pd.merge(df1, df2, on = 'Date', how = 'inner')
   df4 = df3.set_index('Date')

   return df4
# Create list of dataframes for each country
country_i = [cases(i) for i in countries]

# Merge lists (axis = 0, to see each country separately)
df5 = pd.concat(country_i, axis = 1, sort = True).reset_index()
print(df5)

df5.plot()
plt.show()
